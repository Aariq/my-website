---
title: Retrieve chemical retention indices from NIST with {webchem}!
author: Eric R. Scott
date: '2018-06-28'
slug: webchem
categories:
  - Data Science
  - Research
tags:
  - data-wrangling
  - R
  - webscraping
  - GC/MS
draft: no
header:
  caption: ''
  image: ''
  preview: yes
---



<p>My PhD has involved learning a lot more than I expected about analytical chemistry, and as I’ve been learning, I’ve been trying my best to make my life easier by writing R functions to help me out. Some of those functions have found a loving home in the <code>webchem</code> package, part of <a href="https://ropensci.org/">rOpenSci</a>.</p>
<p>Papers that use gas chromatography to separate and measure chemicals often include a table of the compounds they found along with experimental retention indices and literature retention indices. A retention index is basically a corrected retention time—the time it took for the particular chemical to make it through the gas chromatograph, an instrument designed to separate chemicals, to the detector used to identify the compound (e.g. an FID or mass spectrometer). While the retention time for a particular compound might vary from run to run or beetween labs, the retention <strong>index</strong> should be comparable. Therefore, they are often used to help identify compounds and <a href="https://webbook.nist.gov/chemistry/">NIST</a> maintains a database of retention indeces for researchers to refer to.</p>
<p>Producing such a table of literature retention indices for potentially hundreds of metabolites by hand can be really tedious!</p>
<p>Enter <code>nist_ri()</code>, a handy function I wrote to scrape retention index tables from NIST. Below, I work through an example of how you might use it. First, you need to install the latest version of <code>webchem</code>. My function isn’t in the latest CRAN release at the time of writing this blog post, but you can install from github like so:</p>
<pre class="r"><code>devtools::install_github(&quot;ropensci/webchem&quot;)</code></pre>
<p>To look up a retention index, you need a CAS identifier number for the chemical (For now, at least. Other search methods may be implemented in the future). If you don’t already have CAS numbers, you can get them using other functions in <code>webchem</code> from chemical names or other identifier numbers.</p>
<pre class="r"><code>CASs &lt;- c(&quot;83-34-1&quot;, &quot;119-36-8&quot;, &quot;123-35-3&quot;, &quot;19700-21-1&quot;)</code></pre>
<p>Load the package and take a look at the help file. You’ll see that we need to choose what type of retention index to scrape, what polarity of column, and what kind of teperature program. If you browse one of the <a href="https://webbook.nist.gov/cgi/cbook.cgi?ID=C78706&amp;Units=SI&amp;Mask=2000#Gas-Chrom">NIST sites for a compound</a>, this will make more sense.</p>
<pre class="r"><code>library(webchem)
?nist_ri</code></pre>
<p>Let’s get Van Den Dool &amp; Kratz (AKA “linear”) retention indeces for non-polar columns using a temperature ramp. This might take a while, depending on your internet connection and how many CAS numbers you request data for. If a certain type of retention index doesn’t exist for a compound, the function will return <code>NA</code> for all columns but the CAS number.</p>
<pre class="r"><code>RIs &lt;- nist_ri(CASs, &quot;linear&quot;, &quot;non-polar&quot;, &quot;ramp&quot;)
head(RIs)</code></pre>
<p>You can see there are multiple retention indices (<code>RI</code>) for each CAS number. Let’s filter this down some more using some functions from <code>dplyr</code> and <code>stringr</code>.</p>
<pre class="r"><code>library(dplyr)
library(stringr)
RIs_filtered &lt;-
  RIs %&gt;%
  filter(gas == &quot;Helium&quot;,
         between(length, 20, 30),
         str_detect(phase, &quot;5&quot;),
         diameter &lt; 0.3,
         thickness == 0.25)
head(RIs_filtered)</code></pre>
<p>Now we could <code>summarise</code> to get an average of all the database entries…</p>
<pre class="r"><code>RIs_filtered %&gt;% 
  group_by(CAS) %&gt;% 
  summarise(mean_RI = mean(RI))</code></pre>
<p>Or if we wanted to pick a single entry for each CAS number with the median RI, we could do that as well.</p>
<pre class="r"><code>best_RIs &lt;-
  RIs_filtered %&gt;%
  group_by(CAS) %&gt;% 
  filter(RI == median(RI)) %&gt;% 
  filter(row_number() == 1) %&gt;% 
  select(CAS, RI, reference)
best_RIs</code></pre>
<p>You could then easily take this table and <code>*_join()</code> it to your GC/MS data, if you have a column for CAS#, and select the <code>RI</code> and <code>reference</code> columns, for example.</p>
<pre class="r"><code>fake.data &lt;-
  data.frame(CAS = CASs,
             #Name = cts_convert(CASs, from = &quot;CAS&quot;, to = &quot;Chemical Name&quot;, first = TRUE),
             Name = c(&quot;skatole&quot;, &quot;methyl salicylate&quot;, &quot;beta-myrcene&quot;, &quot;geosmin&quot;),
             group_1_conc = round(abs(rnorm(4)), 3),
             group_2_conc = round(abs(rnorm(4)), 3))

left_join(fake.data, best_RIs) %&gt;%
  select(CAS, Name, RI, everything()) %&gt;% 
  arrange(RI) %&gt;%
  knitr::kable()</code></pre>
